function capturePhoto() {
    if (captureCount >= maxPhotos) {
        showCapturedPhotos();
        return;
    }

    shutterSound.play();
    document.body.appendChild(flashEffect);
    setTimeout(() => flashEffect.style.opacity = 1, 0);
    setTimeout(() => flashEffect.style.opacity = 0, 100);

    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;

    // ตรวจสอบว่าเป็นแนวตั้งหรือแนวนอน
    const isPortrait = canvas.height > canvas.width;

    // ถ้าเป็นภาพแนวตั้ง (สูงมากกว่ากว้าง) เปลี่ยนเป็นแนวนอน
    if (isPortrait) {
        canvas.width = video.videoHeight;  // ตั้งค่าความกว้างใหม่
        canvas.height = video.videoWidth;  // ตั้งค่าความสูงใหม่
    }

    const context = canvas.getContext('2d');
    context.drawImage(video, 0, 0, canvas.width, canvas.height);

    capturedPhotos.push(canvas.toDataURL('image/png')); // เก็บภาพใน localStorage

    captureCount++;
    photoCount.innerText = `${captureCount}/${maxPhotos}`;

    if (captureCount < maxPhotos) {
        setTimeout(() => startCountdown(5, capturePhoto), 5000);
    } else {
        // ถ่ายรูปครบแล้วไปที่หน้ารวมภาพ
        showCapturedPhotos();
    }
}
